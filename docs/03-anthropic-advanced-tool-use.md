# Token çœ 76%ã€è²»ç”¨é™ 96%ã€å¿« 4.6 å€â€”â€”è®€å®Œ Anthropic Tool Use è«–æ–‡ï¼Œ4 commits ç•¶å¤©è½åœ°

> Anthropic ç™¼è¡¨ [Advanced Tool Use](https://www.anthropic.com/engineering/advanced-tool-use)ï¼Œæå‡ºä¸‰å€‹åŠŸèƒ½ã€‚æˆ‘å€‘åœ¨æ—¥æœ¬é„‰ä¸‹ç¶“ç‡Ÿ 39 æœå‹™çš„ API å¹³å°ï¼Œè®€å®Œç•¶å¤©å…¨éƒ¨è½åœ°â€”â€”é‚„å¤šåšäº†å››ä»¶ä»–å€‘æ²’åšçš„äº‹ã€‚

---

## å…¨è²Œ

| Anthropic åŠŸèƒ½                  | ä»–å€‘çš„æ•¸æ“š                  | æˆ‘å€‘åšäº†ä»€éº¼                          |
| ----------------------------- | ---------------------- | ------------------------------- |
| **Tool Search**               | 77Kâ†’8.7K tokens (85%â†“) | 10.8KBâ†’2.5KBï¼ŒæŒ‰éœ€è¼‰å…¥ (**76%â†“**)    |
| **Tool Use Examples**         | æº–ç¢ºç‡ 72%â†’90%            | 11 å€‹ç«¯é»åŠ çœŸå¯¦ JSON ç¯„ä¾‹               |
| **Programmatic Tool Calling** | tokens 37%â†“            | PTC æ¨¡å¼ï¼š**$0.02 vs $0.49ï¼Œçœ 96%** |

| æˆ‘å€‘å¤šåšçš„            | ä¸€å¥è©±                   |
| ---------------- | --------------------- |
| **å®¹éŒ¯éˆ** (L2)     | é¸å°ä¹Ÿæœƒæ›ï¼Œ4 å±¤ fallback æ¥ä½ |
| **è€ƒè©¦è·¯ç”±** (P1-P4) | æŒçºŒè€ƒè©¦é©…å‹•ä¾›æ‡‰å•†æ’å           |
| **æ„åœ–è·¯ç”±** (L3)    | èªªäººè©±ï¼Œç³»çµ±è‡ªå·±é¸å·¥å…·           |
| **å“è³ªä¿¡è™Ÿ** (L4)    | çµ¦æ©Ÿå™¨è®€çš„çµæœå“è³ªåˆ†æ•¸           |

---

## èƒŒæ™¯ï¼šç—›é»é€¼å‡ºä¾†çš„å››å±¤

```
L1  Proxy        â€” ç´”è½‰ç™¼ï¼ˆ27 ç«¯é»ï¼‰         $0-$0.01
L2  Smart Gateway â€” å¤šä¾›æ‡‰å•†å®¹éŒ¯ + ç­–ç•¥è·¯ç”±    $0.006-$0.009
L3  Concierge    â€” è‡ªç„¶èªè¨€ â†’ è‡ªå‹•é¸å·¥å…·      $0.02
L4  Task Engine  â€” è¦åŠƒ â†’ åŸ·è¡Œ â†’ å“è³ªè©•ä¼°     $0.49-$2.99
```

ä¸æ˜¯å…ˆç•«æ¶æ§‹åœ–å†è“‹çš„ã€‚L1 ç´”è½‰ç™¼ã€‚L2 æ˜¯ Brave æ›äº†å…©å°æ™‚ã€å®¢æˆ¶å…¨æ‹¿ 500 error å¾ŒåŠ çš„å®¹éŒ¯éˆã€‚L3 æ˜¯ Agent ä¸çŸ¥é“å« search é‚„æ˜¯ newsã€ä¹Ÿä¸çŸ¥é“è¦å…ˆç¿»æ—¥æ–‡å¾ŒåŠ çš„æ„åœ–è·¯ç”±ã€‚L4 æ˜¯ã€Œæ¯”è¼ƒä¸‰å€‹ç¿»è­¯ API å“è³ªã€é€™ç¨®å¤šæ­¥é©Ÿä»»å‹™æä¸å®šå¾ŒåŠ çš„ã€‚æ¯å±¤éƒ½æ˜¯ä¸€å€‹ç—›é»ã€‚

---

## å°ç…§ï¼šAnthropic ä¸‰åŠŸèƒ½

### Tool Search â†’ defer_loadingï¼ˆçœ 76%ï¼‰

> *ã€ŒWith 200+ tools, the traditional approach consumed approximately 77K input tokens before any actual work began... With the Tool Search Tool, initial token consumption drops to approximately 8.7K.ã€*

æˆ‘å€‘çš„ `/api/capabilities` ä¸€å£æ°£å› 10.8KBã€‚è®€åˆ°è«–æ–‡å¾Œç•¶å¤©æ‹†æˆå…©å±¤ï¼š

```bash
GET /api/services/brief     # 2.5KB èœå–®
GET /api/services/{id}      # ~300B æŒ‰éœ€
```

```json
// GET /api/services/brief å›å‚³ï¼ˆç¯€éŒ„ï¼‰
{
  "v": "2.0", "total": 39,
  "services": [
    {"id": "brave-search", "price": 0.002, "cat": "search", "L": 1},
    {"id": "smart-search", "price": 0.009, "cat": "search", "L": 2},
    {"id": "smart",        "price": 0.02,  "cat": "concierge", "L": 3},
    {"id": "task",         "price": 0.05,  "cat": "orchestration", "L": 4}
  ],
  "free": ["weather", "wikipedia", "exchange-rate", "ip-geo", "geocode"],
  "detail": "/api/services/{id}"
}
```

| ä¹‹å‰                     | ä¹‹å¾Œ                  | ç¯€çœ      |
| ---------------------- | ------------------- | ------- |
| 10.8KB (~2,700 tokens) | 2.5KB (~640 tokens) | **76%** |

Anthropic åœ¨æ¨¡å‹ç«¯ï¼ˆClaude è‡ªå·±æœï¼Œç”¨ `defer_loading: true`ï¼‰ï¼Œæˆ‘å€‘åœ¨ API ç«¯ï¼ˆAgent è‡ªå·±è¼‰ï¼Œæ‹†æˆå…©å€‹ç«¯é»ï¼‰ã€‚ä»–å€‘çš„æ›´å„ªé›…ï¼Œæˆ‘å€‘çš„æ›´ç›´æ¥ã€‚åŸç†ä¸€æ¨£ï¼š**å…ˆçµ¦èœå–®ï¼Œå†ä¸Šèœã€‚**

**å­¸åˆ°ä»€éº¼ï¼š** Anthropic å¹«æˆ‘å€‘å‘½åäº†å•é¡Œï¼ˆ`defer_loading`ï¼‰ã€é‡åŒ–äº†å½±éŸ¿ï¼ˆ85%â†“ + Opus 4 æº–ç¢ºç‡ 49%â†’74%ï¼‰ã€çµ¦äº†å¯¦ä½œæ–¹å‘ã€‚ã€Œè¦ºå¾—å¤ªè‚¥ã€è·Ÿã€ŒçŸ¥é“æ€éº¼æ”¹ã€æ˜¯å…©å›äº‹ã€‚

---

### Tool Use Examplesï¼ˆAnthropic å¯¦æ¸¬ +18% æº–ç¢ºç‡ï¼‰

> *ã€ŒAdding concrete examples to tool definitions improved accuracy from 72% to 90% on complex parameter handling.ã€*

æˆ‘å€‘æ–‡ä»¶æœ‰ URL æœ‰åƒæ•¸â€”â€”å”¯ç¨æ²’ç¯„ä¾‹ã€‚Agent åœ¨çŒœæ ¼å¼ï¼š

```
çŒœçš„ï¼š{"search": "renewable energy Japan"}         â† æ¬„ä½åéŒ¯äº†
æ­£ç¢ºï¼š{"query": "renewable energy Japan", "strategy": "fast"}
```

ç•¶å¤© 11 å€‹ç«¯é»å…¨åŠ çœŸå¯¦ JSON è«‹æ±‚+å›æ‡‰ç¯„ä¾‹ï¼š

```
## POST /api/v2/search
### è«‹æ±‚ç¯„ä¾‹ï¼š
{"query": "renewable energy Japan 2025", "strategy": "fast", "maxResults": 10}
### å›æ‡‰ç¯„ä¾‹ï¼š
{"results": [...], "provider": "brave", "responseTimeMs": 420, "cost": "$0.009"}
```

**èŠ±å¹¾å€‹æœˆè“‹çš„å®¹éŒ¯éˆï¼Œå¯èƒ½æ¯”ä¸ä¸ŠèŠ±ä¸€å¤©åŠ çš„ç¯„ä¾‹â€”â€”ç¯„ä¾‹å¾æºé ­æ¸›å°‘éŒ¯èª¤å‘¼å«ã€‚Agent ä¸æ‰“å®¢æœé›»è©±ï¼Œåªçœ‹æ–‡ä»¶ã€‚**

---

### Programmatic Tool Calling â†’ PTCï¼ˆçœ 96% è²»ç”¨ï¼‰

> *ã€ŒProgrammatic Tool Calling enables Claude to write and execute code that orchestrates multiple tool calls... On complex research tasks, this approach reduced average token usage from 43,588 to 27,297 â€” a 37% reduction.ã€*

æˆ‘å€‘çš„ L4 å·²æœ‰ä¸‰éšæ®µï¼ˆè¦åŠƒâ†’åŸ·è¡Œâ†’å“è³ªè©•ä¼°ï¼‰ã€‚è®€å®Œè«–æ–‡åŠ äº† PTCâ€”â€”Agent è‡ªå¸¶æ­¥é©Ÿï¼Œè·³é LLM è¦åŠƒï¼š

```json
// PTC Mode â€” Agent è‡ªå¸¶åŸ·è¡Œè¨ˆç•«
POST /api/v2/task
{"goal": "Search and summarize AI news", "steps": [
  {"toolId": "smart-search", "params": {"query": "AI agent news 2026"}},
  {"toolId": "smart-llm", "params": {"prompt": "Summarize"}, "dependsOn": [1]}
]}

// å›å‚³
{"success": true, "mode": "ptc", "synthesis": "...",
 "meta": {"price": 0.02, "execution": [
   {"step": 1, "tool": "smart-search", "responseTimeMs": 1408},
   {"step": 2, "tool": "smart-llm",    "responseTimeMs": 1292}
 ], "totalTimeMs": 3979}}
```

| å ´æ™¯    | Auto        | PTC         | ç¯€çœ           |
| ----- | ----------- | ----------- | ------------ |
| å–®æ­¥æŸ¥è©¢  | ~12s, $0.49 | 2.8s, $0.02 | å¿« 4xï¼Œçœ 96%   |
| æœå°‹+æ‘˜è¦ | ~18s, $0.49 | 3.9s, $0.02 | å¿« 4.6xï¼Œçœ 96% |

Anthropic è®“ Claude å¯« Python ç·¨æ’ï¼ˆæ›´éˆæ´»ï¼‰ã€‚æˆ‘å€‘è®“ Agent æäº¤ JSON æ­¥é©Ÿï¼ˆæ›´å¯é ï¼Œæ¯æ­¥æœ‰ L2 å®¹éŒ¯ï¼‰ã€‚Agent ä»˜äº†éŒ¢ï¼Œè¦çš„æ˜¯çµæœï¼Œä¸æ˜¯ä¸€å€‹å¯èƒ½æœƒè·‘çš„ Python scriptã€‚

---

## æˆ‘å€‘å¤šåšçš„å››ä»¶äº‹

### å®¹éŒ¯éˆâ€”â€”é¸å°äº†ä¹Ÿæœƒæ›

Anthropic å‡è¨­é¸å°å·¥å…·å°±æœƒæ‹¿åˆ°çµæœã€‚ç”Ÿç”¢ç’°å¢ƒè£¡ï¼Œ**é¸å°äº†ä¹Ÿæœƒæ›ã€‚**

```
Agent å« POST /api/v2/search
  â†’ Brave (8s) â†’ Tavily (10s) â†’ Firecrawl (20s) â†’ Gemini (20s)
  Agent å®Œå…¨æ„ŸçŸ¥ä¸åˆ°é€™æ¢éˆã€‚
```

**çœŸå¯¦æ¡ˆä¾‹ï¼š** æŸå¤©ä¸‹åˆ Brave æ›äº† 6 åˆ†é˜ï¼š

```
14:25  Brave timeout â†’ fallback Tavily â†’ æˆåŠŸï¼Œ1200ms
14:31  Brave æ¢å¾©ã€‚å®¢æˆ¶å®Œå…¨ä¸çŸ¥é“ã€‚
```

æ²’æœ‰å®¹éŒ¯éˆï¼Ÿ6 åˆ†é˜çš„ 500 errorã€‚æœ‰å®¹éŒ¯éˆï¼Ÿ`provider` å¾ `"brave"` è®Š `"tavily"`ï¼Œçµæœç…§å›ã€‚

---

### è€ƒè©¦è·¯ç”±ï¼ˆP1-P4ï¼‰â€”â€”éœæ…‹ç¯„ä¾‹æœƒéæ™‚

Anthropic èªªåŠ ç¯„ä¾‹æº–ç¢ºç‡ +18%ã€‚ä½†**éœæ…‹ç¯„ä¾‹æœƒéæ™‚ã€‚** ä¸Šå€‹æœˆæœ€å¥½çš„ä¾›æ‡‰å•†ï¼Œé€™å€‹æœˆå¯èƒ½é™ç´šäº†ã€‚

| è€ƒè©¦     | å•ä»€éº¼     | é »ç‡   | é©…å‹•ä»€éº¼           |
| ------ | ------- | ---- | -------------- |
| **P1** | ç«¯é»æ´»è‘—å—ï¼Ÿ  | æ¯ 6h | ç§»å‡ºæ­»ä¾›æ‡‰å•†         |
| **P3** | èª°çš„çµæœæœ€å¥½ï¼Ÿ | æ¯é€±   | **é©…å‹• L2 è·¯ç”±æ’å** |
| **P4** | é•·æœŸç©©å®šå—ï¼Ÿ  | æ¯æœˆ   | æ±ºå®š fallback é †åº |

**çœŸå¯¦ç™¼ç¾ï¼š** P3 è‡ªå‹•ç™¼ç¾æŸä¾›æ‡‰å•†æ—¥æ–‡ query ç›¸é—œæ€§æ¯”è‹±æ–‡é«˜ 15%ã€‚æ²’äººè¨­è¨ˆé€™å€‹â€”â€”è€ƒè©¦æ•¸æ“šè‡ªå·±æµ®ç¾ã€‚ç³»çµ±è‡ªå‹•èª¿æ•´ï¼šæ—¥æ–‡æœå°‹åå¥½ä¾›æ‡‰å•† Aï¼Œè‹±æ–‡åå¥½ Bã€‚æ‰‹å¯«ç¯„ä¾‹æ°¸é æ‰¾ä¸åˆ°é€™ç¨® patternã€‚

---

### æ„åœ–è·¯ç”±ï¼ˆL3ï¼‰â€”â€”Agent ä¸çŸ¥é“å«èª°

Anthropic å‡è¨­å‘¼å«è€…çŸ¥é“è¦ç”¨å“ªå€‹å·¥å…·ã€‚å¸¸å¸¸ä¸æˆç«‹ã€‚

```
ã€Œæ—¥æœ¬äººæ€éº¼çœ‹æ–°å¹¹ç·šå»¶ä¼¸ï¼Ÿã€

L3 (<500ms)ï¼šæœå°‹(æ—¥æ–‡) â†’ ç¿»è­¯ â†’ æ‘˜è¦ã€‚ä¸‰æ­¥è‡ªå‹•åŸ·è¡Œã€‚

æ²’æœ‰ L3ï¼šAgent è©¦éŒ¯ â†’ 4-5 æ¬¡å‘¼å« â†’ $0.03-0.05ï¼Œ8-15 ç§’
æœ‰ L3ï¼š  ä¸€å¥è‡ªç„¶èªè¨€  â†’ 3 æ¬¡ç²¾æº–   â†’ $0.009ï¼Œ3-5 ç§’
```

æ„åœ–è§£æ ~$0.0002/æ¬¡ï¼ŒROI 100-200 å€ã€‚

---

### å“è³ªä¿¡è™Ÿï¼ˆPhase 3ï¼‰â€”â€”æ€éº¼çŸ¥é“çµæœå¥½ä¸å¥½

Anthropic å„ªåŒ–ã€Œåˆ°åŸ·è¡Œå‰ã€çš„è·¯å¾‘ã€‚ä½†**å‘¼å«å®Œä¹‹å¾Œå‘¢ï¼Ÿ**

```
Phase 3 è©•ä¼° â†’ overall: 0.49ï¼ˆçµæœå¤ªèˆŠï¼‰â†’ è‡ªå‹•é‡è·‘ â†’ 0.83 âœ…
```

å“è³ªåˆ†æ•¸æ˜¯**çµ¦æ©Ÿå™¨è®€çš„**ã€‚Agent ä¸ç”¨äºŒé¸ä¸€ï¼ˆå…¨ä¿¡ or å…¨ä¸ä¿¡ï¼‰ï¼Œå¯ä»¥**æœ‰æ¢ä»¶åœ°ä¿¡ä»»**â€”â€”0.83 å¤ å¥½ï¼Œç”¨é€™å€‹å¯«åˆç¨¿ï¼Œä½†æ¨™è¨»å¼±é»éƒ¨åˆ†éœ€è¦å†è£œã€‚

---

## å“²å­¸å·®ç•°

|         | Anthropic      | å’Œå¿ƒæ‘             |
| ------- | -------------- | --------------- |
| **æ–¹å‘**  | æ¨¡å‹æ›´è°æ˜åœ°æŒ‘å·¥å…·      | å·¥å…·æ›´å®¹æ˜“è¢«æŒ‘åˆ°        |
| **æ§åˆ¶æ¬Š** | æ¨¡å‹å´ï¼ˆClaude æ±ºå®šï¼‰ | API å´ï¼ˆAgent æ±ºå®šï¼‰ |
| **ç¯„åœ**  | Claude only    | ä»»ä½• LLM/Agent    |
| **å®šåƒ¹**  | è—åœ¨ token è£¡     | æ¯æ­¥é€æ˜ï¼ˆé‡‘é¡+æ™‚é–“ï¼‰     |

**Anthropic å„ªåŒ–ã€Œæ¨¡å‹æ€éº¼æŒ‘å·¥å…·ã€ï¼Œæˆ‘å€‘å„ªåŒ–ã€Œå·¥å…·æ€éº¼è®“è‡ªå·±è¢«æŒ‘åˆ°ã€ã€‚æ®Šé€”åŒæ­¸ã€‚**

---

## æ•¸æ“š

| æŒ‡æ¨™            | å€¼                           |
| ------------- | --------------------------- |
| æœå‹™            | 39ï¼ˆL1Ã—27 + L2Ã—10 + L3 + L4ï¼‰ |
| åˆ†é¡            | 15                          |
| Defer Loading | 10.8KB â†’ 2.5KBï¼ˆ76%â†“ï¼‰        |
| PTC vs Auto   | $0.02 vs $0.49ï¼ˆ96%â†“ï¼‰        |
| è€ƒè©¦é€±æœŸ          | P1 æ¯ 6h / P3 æ¯é€± / P4 æ¯æœˆ     |
| é–‹ç™¼            | 7 å€‹æœˆï¼Œå·¥ç¨‹èƒŒæ™¯ **é›¶**             |

---

æ–¹å‘æ­£ç¢ºâ€”â€”ç¨ç«‹æƒ³åˆ°çš„æ¶æ§‹ï¼Œè·Ÿé ‚ç´šå¯¦é©—å®¤ä¸€è‡´ã€‚æ‡‰ç”¨å±¤æœ‰ç©ºé–“â€”â€”å®¹éŒ¯éˆã€è€ƒè©¦è·¯ç”±ã€å“è³ªä¿¡è™Ÿï¼Œæ¨¡å‹å±¤åšä¸åˆ°ã€‚

**è®€äº†è«–æ–‡ã€‚å­¸åˆ°æ±è¥¿ã€‚ç•¶å¤©å°±åšäº†ã€‚**

---

**References** â€” [Anthropic Advanced Tool Use](https://www.anthropic.com/engineering/advanced-tool-use) (2025) Â· [Zero Engineer](https://github.com/sstklen/zero-engineer) Â· [112 Claude Code Skills](https://github.com/sstklen/washin-claude-skills) Â· [crawl-share](https://github.com/sstklen/crawl-share) Â· [Confucius Debug](https://github.com/sstklen/yanhui-ci)

```
ca35575  feat: input_examples â€” 11 ç«¯é»é™„ç¯„ä¾‹
b31168c  feat: defer_loading â€” è¶…è¼•ç´¢å¼• + æŒ‰éœ€è¼‰å…¥
9174e59  feat: dynamic filtering â€” 5 ç¨®ç¯©é¸åƒæ•¸
8f4a50d  feat: PTC â€” L4 æ”¯æ´è‡ªå¸¶åŸ·è¡Œè¨ˆç•«
```

**ä¸€å€‹ä¸‹åˆï¼Œ4 å€‹ commitã€‚** *Built with ğŸ¦ in Boso Peninsula, Japan.*
